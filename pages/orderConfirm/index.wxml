<!--orderConfirm/index.wxml-->
<view class="container">
  <!-- 收货地址 -->
  <view class="address-section" bindtap="navigateToAddress">
    <block wx:if="{{address}}">
      <view class="address-info">
        <view class="address-name-phone">
          <text class="address-name">{{address.name}}</text>
          <text class="address-phone">{{address.phone}}</text>
        </view>
        <view class="address-detail">{{address.province}}{{address.city}}{{address.district}}{{address.detail}}</view>
      </view>
    </block>
    <block wx:else>
      <view class="no-address">
        <text>请选择收货地址</text>
      </view>
    </block>
    <view class="address-arrow">
      <image src="cloud://cloud1-2gz5tcgibdf4bfc0.636c-cloud1-2gz5tcgibdf4bfc0-1360056125/images/arrow_right.png" class="arrow-icon"></image>
    </view>
  </view>
  
  <!-- 商品列表 -->
  <view class="products-section">
    <view class="section-title">商品信息</view>
    <view class="product-list">
      <view class="product-item" wx:for="{{orderItems}}" wx:key="productId">
        <image src="{{item.productImage}}" class="product-image" mode="aspectFill"></image>
        <view class="product-info">
          <view class="product-name text-ellipsis-2">{{item.productName}}</view>
          <view class="product-spec" wx:if="{{item.specName}}">规格：{{item.specName}}</view>
          <view class="product-price-quantity">
            <text class="product-price">¥{{item.price}}</text>
            <text class="product-quantity">x{{item.quantity}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 配送方式 -->
  <view class="delivery-section">
    <view class="section-item">
      <text class="item-label">配送方式</text>
      <text class="item-value">快递配送</text>
    </view>
  </view>
  
  <!-- 优惠券 -->
  <view class="coupon-section" bindtap="showCouponPopup">
    <view class="section-item">
      <text class="item-label">优惠券</text>
      <view class="item-value-arrow">
        <text class="item-value {{selectedCoupon ? 'primary-color' : ''}}">{{selectedCoupon ? '满'+selectedCoupon.minAmount+'减'+selectedCoupon.amount : '暂无可用'}}</text>
        <image src="cloud://cloud1-2gz5tcgibdf4bfc0.636c-cloud1-2gz5tcgibdf4bfc0-1360056125/images/arrow_right.png" class="arrow-icon"></image>
      </view>
    </view>
  </view>
  
  <!-- 订单备注 -->
  <view class="remark-section">
    <view class="remark-title">订单备注</view>
    <textarea class="remark-input" placeholder="选填，请先和商家协商一致" maxlength="100" bindinput="onRemarkInput" value="{{remark}}"></textarea>
  </view>
  
  <!-- 金额明细 -->
  <view class="amount-section">
    <view class="amount-item">
      <text>商品金额</text>
      <text>¥{{productAmount}}</text>
    </view>
    <view class="amount-item">
      <text>运费</text>
      <text>¥{{shippingFee}}</text>
    </view>
    <view class="amount-item" wx:if="{{couponAmount > 0}}">
      <text>优惠券</text>
      <text class="discount">-¥{{couponAmount}}</text>
    </view>
    <view class="amount-total">
      <text>实付款</text>
      <text class="total-price">¥{{totalAmount}}</text>
    </view>
  </view>
  
  <!-- 底部支付栏 -->
  <view class="pay-bar">
    <view class="pay-amount">
      <text>合计：</text>
      <text class="pay-price">¥{{totalAmount}}</text>
    </view>
    <button class="btn-pay" bindtap="submitOrder">提交订单</button>
  </view>
  
  <!-- 优惠券选择弹窗 -->
  <view class="coupon-popup {{showCoupon ? 'show' : ''}}">
    <view class="popup-mask" bindtap="hideCouponPopup"></view>
    <view class="popup-content">
      <view class="popup-header">
        <text class="popup-title">优惠券</text>
        <view class="popup-close" bindtap="hideCouponPopup">×</view>
      </view>
      
      <view class="popup-body">
        <view class="coupon-list">
          <view class="coupon-item {{item.id === (selectedCoupon ? selectedCoupon.id : '') ? 'active' : ''}}" 
                wx:for="{{availableCoupons}}" 
                wx:key="id"
                bindtap="selectCoupon"
                data-coupon="{{item}}">
            <view class="coupon-left">
              <view class="coupon-value">
                <text class="coupon-unit">¥</text>
                <text class="coupon-amount">{{item.amount}}</text>
              </view>
              <view class="coupon-condition">满{{item.minAmount}}元可用</view>
            </view>
            <view class="coupon-right">
              <view class="coupon-name">{{item.name}}</view>
              <view class="coupon-date">{{item.validityPeriod}}</view>
              <view class="coupon-select">
                <image src="{{item.id === (selectedCoupon ? selectedCoupon.id : '') ? 'cloud://cloud1-2gz5tcgibdf4bfc0.636c-cloud1-2gz5tcgibdf4bfc0-1360056125/images/checkbox_selected.png' : 'cloud://cloud1-2gz5tcgibdf4bfc0.636c-cloud1-2gz5tcgibdf4bfc0-1360056125/images/checkbox.png'}}" class="select-icon"></image>
              </view>
            </view>
          </view>
          
          <view class="no-coupon" wx:if="{{availableCoupons.length === 0}}">
            <text>暂无可用优惠券</text>
          </view>
        </view>
      </view>
      
      <view class="popup-footer">
        <button class="btn-confirm" bindtap="confirmCoupon">确定</button>
      </view>
    </view>
  </view>
</view>
