<view class="container">
  <!--
  <view class="search-bar">
    <input placeholder="搜索狗狗零食、玩具..." />
    <button size="mini">搜索</button>
  </view>
  -->

  <swiper wx:if="{{banners && banners.length > 0}}" class="banner-swiper" indicator-dots="{{banners.length > 1}}" autoplay="true" interval="3000" duration="500" circular="true">
    <block wx:for="{{banners}}" wx:key="_id">
      <swiper-item class="banner-item" bindtap="onBannerTap" data-item="{{item}}">
        <image src="{{item.imageUrl}}" class="banner-image" mode="aspectFill" lazy-load="true" />
      </swiper-item>
    </block>
  </swiper>
  <view wx:else class="banner-placeholder">
    </view>

  <view class="category-section" wx:if="{{categories && categories.length > 0}}">
    <view class="section-title">
      <text>快速分类</text>
      </view>
    <view class="category-list">
      <view wx:for="{{categories}}" wx:key="_id" class="category-item" bindtap="onCategoryTap" data-id="{{item._id}}">
        <image class="category-icon" src="{{item.iconUrl}}" mode="aspectFit" lazy-load="true"/>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <view class="coupon-section" wx:if="{{coupons && coupons.length > 0}}">
    <view class="section-title">
      <text>优惠大放送</text>
      <text class="more-link" bindtap="onMoreCouponTap">更多优惠 ></text>
    </view>
    <scroll-view scroll-x="true" class="coupon-scroll-list">
      <view wx:for="{{coupons}}" wx:key="_id" class="coupon-item-wrapper">
        <view class="coupon-item" bindtap="onCouponTap" data-id="{{item._id}}">
          <view class="coupon-value">
            <text wx:if="{{item.type === 'fixed_amount'}}" class="amount-symbol">¥</text>
            <text class="amount-number">{{item.type === 'fixed_amount' ? item.amount : item.amount * 10}}</text>
            <text wx:if="{{item.type === 'discount'}}" class="amount-symbol">折</text>
          </view>
          <view class="coupon-info">
            <text class="coupon-name">{{item.name}}</text>
            <text class="coupon-condition">满{{item.minAmount}}元可用</text>
            <text class="coupon-validity">{{item.description || '有效期至: ' + (item.endTime ? item.endTime : '长期有效')}}</text>
          </view>
          <view class="coupon-action">
            <button size="mini" class="receive-btn">立即领取</button>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <view class="product-section new-products-section" wx:if="{{newProducts && newProducts.length > 0}}">
    <view class="section-title">
      <text>新品尝鲜</text>
      <text class="more-link" bindtap="onMoreNewProductTap">更多新品 ></text>
    </view>
    <view class="product-grid">
      <view wx:for="{{newProducts}}" wx:key="_id" class="product-card-item" bindtap="onProductTap" data-id="{{item._id}}">
        <image class="product-image" src="{{item.mainImage}}" mode="aspectFill" lazy-load="true"/>
        <view class="product-info">
          <text class="product-name" numberOfLines="2">{{item.name}}</text>
          <view class="product-price-row">
            <text class="product-price">¥{{item.price}}</text>
            <text wx:if="{{item.originalPrice && item.originalPrice > item.price}}" class="product-original-price">¥{{item.originalPrice}}</text>
          </view>
        </view>
         <view class="product-tags">
          <text class="tag new-tag">新品</text>
        </view>
      </view>
    </view>
  </view>

  <view class="product-section hot-products-section" wx:if="{{hotProducts && hotProducts.length > 0}}">
    <view class="section-title">
      <text>热销榜单</text>
      <text class="more-link" bindtap="onMoreHotProductTap">更多热销 ></text>
    </view>
    <view class="product-grid">
      <view wx:for="{{hotProducts}}" wx:key="_id" class="product-card-item" bindtap="onProductTap" data-id="{{item._id}}">
        <image class="product-image" src="{{item.mainImage}}" mode="aspectFill" lazy-load="true"/>
        <view class="product-info">
          <text class="product-name" numberOfLines="2">{{item.name}}</text>
           <view class="product-price-row">
            <text class="product-price">¥{{item.price}}</text>
            <text wx:if="{{item.originalPrice && item.originalPrice > item.price}}" class="product-original-price">¥{{item.originalPrice}}</text>
          </view>
        </view>
        <view class="product-tags">
          <text class="tag hot-tag">热销</text>
          <text wx:if="{{item.sales > 0}}" class="tag sales-tag">已售{{item.sales}}</text>
        </view>
      </view>
    </view>
    <view class="load-more-hint" wx:if="{{isHotProductsLoading}}">正在加载更多热销...</view>
    <view class="load-more-hint" wx:if="{{!isHotProductsLoading && isHotProductsEnd && hotProducts.length > hotProductsPageSize}}">没有更多热销商品啦~</view>
  </view>

  <view class="brand-section" wx:if="{{brandInfo && brandInfo.title}}" bindtap="onBrandTap">
    <image wx:if="{{brandInfo.imageUrl}}" src="{{brandInfo.imageUrl}}" class="brand-logo" mode="aspectFit"/>
    <view class="brand-text">
      <text class="brand-title">{{brandInfo.title}}</text>
      <text class="brand-description">{{brandInfo.description}}</text>
    </view>
  </view>

  <view wx:if="{{isLoading && (!banners || banners.length === 0)}}" class="page-loading">
    <text>页面加载中...</text>
  </view>
  <view wx:if="{{isPageError}}" class="page-error">
    <text>{{errorMessage || '页面加载失败，请稍后重试'}}</text>
    <button bindtap="fetchHomePageData" size="mini">重试</button>
  </view>

</view>
